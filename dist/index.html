<!DOCTYPE html><head><title>falill</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style type="text/css">body{background:#f0f8ff;font-family:Courier New,Courier,monospace}main{width:25em;display:grid;grid-template-rows:5em 5em 1fr .25fr 5em 5em;grid-template-columns:1fr 1fr 1fr;gap:1em;position:absolute;left:50%;top:5rem;transform:translateX(-50%);margin:2rem}.shadow{box-shadow:4px 4px 0 #7c7c7c,8px 8px 0 #c7c7c7;border-radius:5px;background-color:#8a807e}.block{transform:translateY(0);transition:.125s ease-in-out;display:grid;justify-content:center;align-content:center;font-weight:800;font-size:x-large;user-select:none}h1{display:flex;align-items:center}h1,p{grid-column:1/-1;margin:0;padding:1rem 2rem;color:#fff}canvas{height:25em;image-rendering:pixelated;image-rendering:crisp-edges}.pixels,canvas{width:25em;grid-column:1/-1}.pixels{height:6.25em;display:grid;overflow:hidden}.pixel{background-color:#000;transition:.125s ease-in-out}.pixel:hover{cursor:pointer}.pixel.enabled,.pixel:hover{background-color:#fff}.pixel.enabled:hover{background-color:#a9a9a9}section{display:contents}.block:hover{cursor:pointer;box-shadow:2px 2px 0 #7c7c7c,4px 4px 0 #c7c7c7;transform:translateY(2px)}#btn-1{background-color:#8a807e;color:#f0f8ff}#btn-2{background-color:#dd614a;color:#f0f8ff}#btn-3{background-color:#a5c882;color:#000}</style></head><body><main><h1 class="shadow"></h1><p class="shadow"></p><canvas class="shadow"></canvas><section class="pixels shadow"></section><section><div class="block shadow button" id="btn-1">Reset</div><div class="block shadow button" id="btn-2">Pause</div><div class="block shadow button" id="btn-3">Launch</div><div class="block shadow button" id="btn-4">Next</div></section></main><script type="text/javascript">!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){},function(t,e,r){"use strict";r.r(e);class n{constructor(t){this._gl=t,this.attributes={},this.shaders=[],this.textures=[]}get gl(){return this._gl}addShader(t,e){const r=this.gl,n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),this.shaders.push(n),n}createProgram(){const t=this.gl,e=t.createProgram();for(const r of this.shaders)t.attachShader(e,r);return t.linkProgram(e),t.useProgram(e),e}addBuffer(){const t=this.gl,e=t.createBuffer(),r=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];return this.size=Math.floor(r.length/2),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,e),e}createTexture(t,e,r){const n=this.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,this.gl.UNSIGNED_BYTE,r),o}addTexture(t,e){const r=this.createTexture(t,e,null),n=this.createFramebuffer(r);return this.textures.push({texture:r,framebuffer:n}),r}createFramebuffer(t){const e=this.gl,r=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),r}}class o{constructor(t,e,r){this.canvas=t,this.world=e;const o=t.getContext("webgl")||t.getContext("experimental-webgl");this.manager=new n(o);const{width:i,height:a}=r;this.lastWidth=i,this.lastHeight=a,this._init()}_init(){this.bufferIndex=0,this.pause=!1;const t=this.manager,e=t.gl;t.addBuffer(),t.addShader(e.VERTEX_SHADER,"\nattribute vec2 coordinates;\nvarying vec2 texCoord;\n\nvoid main(void){\n\ttexCoord = (coordinates/2.0 + 0.5);\n\tgl_Position = vec4(coordinates, 1.0, 1.0);\n}\n"),t.addShader(e.FRAGMENT_SHADER,"\nprecision mediump float;\nuniform sampler2D u_image;\nvarying vec2 texCoord;\nuniform vec2 onePixel;\nuniform bool doStep;\n\nvec2 getCoords(vec2 coord, vec2 offset){\n\treturn mod(coord + onePixel * offset, 1.0);\n}\n\nfloat a = 0.0;\nfloat sum = 0.0;\n\nvoid main(void){\n\tif(doStep){\n\t\tfloat r = texture2D(u_image, texCoord).r;\n\t\tfloat g = texture2D(u_image, texCoord).g;\n\t\tfloat b = texture2D(u_image, texCoord).b;\n\t\tfloat a = texture2D(u_image, texCoord).a;\n\t\tfloat sum = r + g + b;\n\n\t\tfloat bR = texture2D(u_image, getCoords(texCoord, vec2(0.0, -1.0))).r;\n\t\tfloat bG = texture2D(u_image, getCoords(texCoord, vec2(0.0, -1.0))).g;\n\t\tfloat bB = texture2D(u_image, getCoords(texCoord, vec2(0.0, -1.0))).b;\n\t\tfloat bSum = bR + bG + bB;\n\n\t\tfloat lR = texture2D(u_image, getCoords(texCoord, vec2(-1.0, 0.0))).r;\n\t\tfloat lG = texture2D(u_image, getCoords(texCoord, vec2(-1.0, 0.0))).g;\n\t\tfloat lB = texture2D(u_image, getCoords(texCoord, vec2(-1.0, 0.0))).b;\n\t\tfloat lSum = lR + lG + lB;\n\n\t\tfloat rR = texture2D(u_image, getCoords(texCoord, vec2(1.0, 0.0))).r;\n\t\tfloat rG = texture2D(u_image, getCoords(texCoord, vec2(1.0, 0.0))).g;\n\t\tfloat rB = texture2D(u_image, getCoords(texCoord, vec2(1.0, 0.0))).b;\n\t\tfloat rSum = rR + rG + rB;\n\n\t\tfloat tR = texture2D(u_image, getCoords(texCoord, vec2(0.0, 1.0))).r;\n\t\tfloat tG = texture2D(u_image, getCoords(texCoord, vec2(0.0, 1.0))).g;\n\t\tfloat tB = texture2D(u_image, getCoords(texCoord, vec2(0.0, 1.0))).b;\n\t\tfloat tSum = tR + tG + tB;\n\n\t\tif ((3.0 - bSum) < 0.001) { // White below\n\t\t\tif (sum < 0.001) { // Go white\n\t\t\t\tgl_FragColor = vec4(255.0, 255.0, 255.0, 1.0);\n\t\t\t} else { // Combine\n\t\t\t\tfloat newR = (r + bR) / 2.;\n\t\t\t\tfloat newG = (g + bG) / 2.;\n\t\t\t\tfloat newB = (b + bB) / 2.;\n\t\t\t\tgl_FragColor = vec4(newR, newG, 255.0, 1.0);\n\t\t\t}\n\t\t} else if ((3.0 - sum) < 0.001) { // Go black fom white\n\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t} else {\n\t\t\tfloat newR = r;\n\t\t\tfloat newG = g;\n\t\t\tfloat newB = b;\n\n\t\t\tfloat diffLB = 1.0 - lB;\n\t\t\tif ((diffLB > 0.001) && (diffLB < 0.45)) { // Blue goes left\n\t\t\t\tnewB = (lB + b) / 2.;\n\t\t\t}\n\t\t\tfloat diffRR = 1.0 - rR;\n\t\t\tif ((diffRR > 0.001) && (diffRR < 0.45)) { // Red goes left\n\t\t\t\tnewR = (rR + r) / 2.;\n\t\t\t}\n\t\t\tfloat diffTG = 1.0 - tG;\n\t\t\tif ((diffTG > 0.001) && (diffTG < 0.45)) { // Red goes left\n\t\t\t\tnewG = (tG + g) / 2.;\n\t\t\t}\n\t\t\tgl_FragColor = vec4(newR, newG, newB, 1.0);\n\t\t}\n\t} else {\n\t\tgl_FragColor = texture2D(u_image, texCoord).rgba;\n\t}\n}\n");const r=t.createProgram(),n=e.getAttribLocation(r,"coordinates");e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n),t.attributes={onePixel:e.getUniformLocation(r,"onePixel"),doStep:e.getUniformLocation(r,"doStep")};const o=this.lastWidth,i=this.lastHeight;this.worldTexture=t.createTexture(o,i,this.world),t.addTexture(o,i),t.addTexture(o,i)}togglePause(){if(this.pause)return this.pause=!1,void this._render();this.pause=!0}render(){const t=this.manager,{gl:e,attributes:r}=t;e.uniform2f(r.onePixel,1/this.lastWidth,1/this.lastHeight),e.uniform1f(r.doStep,!0),e.bindTexture(e.TEXTURE_2D,this.worldTexture),this._render()}_render(t){if(this.pause)return;const{gl:e,attributes:r,size:n,textures:o}=this.manager;e.uniform1f(r.doStep,!0);const{texture:i,framebuffer:a}=o[this.bufferIndex];this.bufferIndex=(this.bufferIndex+1)%2,e.bindFramebuffer(e.FRAMEBUFFER,a),e.drawArrays(e.TRIANGLES,0,n),e.bindTexture(e.TEXTURE_2D,i),e.bindFramebuffer(e.FRAMEBUFFER,null),e.uniform1f(r.doStep,!1),e.drawArrays(e.TRIANGLES,0,n),window.requestAnimationFrame(()=>this._render())}}const i=[["Intro","Description for the first level",[],[[Math.round(17.5),Math.round(17.5),7,[0,0,255,255]],[Math.round(35/3),Math.round(35/3*2),5,[0,0,255,255]]]],["Second","Description for the next level",[],[[Math.round(17.5),Math.round(17.5),7,[255,0,0,255]]]]];((t,e)=>{console.log("[log] Starting");let r=0;const n=()=>{console.log("[log] Resized",35,35),e.width=35,e.height=35},a=(t,e,r)=>e*r*4+4*t,s=(t,e)=>{const[r,n,o,i]=e,[s,l,u,d]=i;for(let e=0;e<2*o;e++)for(let i=0;i<2*o;i++){const d=e-o,f=i-o;if(console.log(d,f,o),d*d+f*f>=o*o)continue;const c=a(r+d,n+f,35);t[c]=s,t[c+1]=l,t[c+2]=u,t[c+3]=255}};let l,u;const d=document.querySelector("h1"),f=document.querySelector("p"),c=(t,r)=>{r&&u&&u.station&&delete u.station;const{renderer:i,state:c}=((t,r)=>{n();const i=new Uint8Array(4900),l=Math.floor(8.75);for(let e=0;e<35;e++)for(let r=0;r<35;r++){if(t&&r<=l){const n=a(e,r,35),o=a(e,l-r-1,35);i[n]=t[o],i[n+1]=t[o+1],i[n+2]=t[o+2],i[n+3]=t[o+3];continue}if(r>l)continue;const n=a(e,r,35);i[n]=(e+r)%2?0:50,i[n+1]=(e+r)%2?0:50,i[n+2]=(e+r)%2?0:50,i[n+3]=5}for(const t of r[3])s(i,t);return{state:{ticks:0,world:i,station:t||new Uint8Array(35*Math.floor(8.75)*4)},renderer:new o(e,i,{width:35,height:35})}})(u?u.station:u,t);d.innerHTML="Level "+t[0],f.innerHTML=t[1],l=i,u=c,l.render()};c(i[0],!0);const g=[1,2,3,4].map(t=>document.getElementById("btn-"+t));g[0].addEventListener("click",()=>(document.querySelectorAll(".pixel.enabled").forEach(t=>t.classList.remove("enabled")),void c(i[r],!0))),g[1].addEventListener("click",()=>{g[1].innerHTML=l.pause?"Pause":"Play",l.togglePause()}),g[2].addEventListener("click",()=>c(i[r],!1)),g[3].addEventListener("click",()=>{r=1===r?0:1,c(i[r],!0)}),window.addEventListener("resize",n,!1);const m=document.querySelector(".pixels"),h=Math.floor(8.75);m.style.gridTemplateColumns="repeat(35, 1fr)",m.style.gridTemplateRows=`repeat(${h}, 1fr)`;const x=(t,e,r,n)=>{const{target:o}=t;o.classList.contains("enabled")?o.classList.remove("enabled"):o.classList.add("enabled");const i=a(e,r,n);u.station[i]=255,u.station[i+1]=255,u.station[i+2]=255,u.station[i+3]=255};for(let t=0;t<h;t++)for(let e=0;e<35;e++){const r=document.createElement("div");r.classList.add("pixel"),r.addEventListener("mouseover",r=>{1!==r.buttons&&3!==r.buttons||x(r,e,t,35)}),r.addEventListener("click",r=>{x(r,e,t,35)}),m.appendChild(r)}})(document.querySelector("main"),document.querySelector("canvas"));r(0)}]);</script></body>